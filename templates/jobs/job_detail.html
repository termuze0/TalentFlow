
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ job.title }} - Job Details</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      padding: 2rem;
    }

    .job-detail-container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .job-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .job-title {
      font-size: 2rem;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .job-meta {
      font-size: 0.95rem;
      color: #777;
    }

    .job-description,
    .job-requirements {
      margin-top: 1.5rem;
    }

    .job-description h3,
    .job-requirements h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #34495e;
    }

    .apply-button-mobile {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      font-size: 0.95rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .apply-button-mobile.unsave {
      background-color: #d32f2f;
    }

    .apply-button-mobile:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

<div class="job-detail-container">
  <div class="job-detail-header">
    <div>
      <h1 class="job-title">{{ job.title }}</h1>
      <div class="job-meta">
        <p>üè¢ {{ job.employer.fullname }}</p>
        <p>üìç {{ job.location }}</p>
        {% if job.salary %}
          <p>üí∞ ${{ job.salary|floatformat:"0" }}</p>
        {% endif %}
        <p>‚è∞ Deadline: {{ job.deadline|date:"M d, Y" }}</p>
        <p>üìÇ Category: {{ job.category.name }}</p>
      </div>
    </div>
    <div>
      <button id="save-job-btn"
              class="apply-button-mobile"
              data-job-id="{{ job.id }}">
        Save Job
      </button>
    </div>
  </div>

  <div class="job-description">
    <h3>Job Description</h3>
    <p>{{ job.description|linebreaks }}</p>
  </div>

  <div class="job-requirements">
    <h3>Requirements</h3>
    <p>{{ job.requirements|linebreaks }}</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async function () {
  const saveBtn = document.getElementById('save-job-btn');
  const jobId = saveBtn?.dataset.jobId;
  const token = localStorage.getItem('session_token');

  if (!saveBtn || !token) return;

  
  try {
    const res = await fetch(`/jobs/saved-jobs/${jobId}/status/`, {
      method: 'GET',
      headers: {
        'Session-Token': token
      }
    });

    const data = await res.json();
    updateButton(data.saved);
  } catch (err) {
    console.error("Could not check saved status");
  }
  saveBtn.addEventListener('click', async () => {
    try {
      const res = await fetch(`/jobs/${jobId}/save/`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Session-Token': token
  },
});
      const data = await res.json();
      if (res.ok) {
        updateButton(data.saved);
      } else {
        alert(data.error || "Something went wrong.");
      }
    } catch (err) {
      console.error("Error saving job", err);
    }
  });

  function updateButton(isSaved) {
    saveBtn.textContent = isSaved ? 'Unsave Job' : 'Save Job';
    saveBtn.classList.toggle('unsave', isSaved);
  }
});
</script>

</body>
</html>
